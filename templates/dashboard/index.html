{% extends "base.html" %}

{% block title %}AuditPro - Dashboard{% endblock %}

{% block content %}
<div class="animate-fade-in-up">
    <!-- Page Heading -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold tracking-tight text-slate-900 dark:text-white mb-2">Dashboard</h1>
        <p class="text-slate-500 dark:text-slate-400">Real-time overview of your compliance assessments</p>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
        <!-- Total Projects -->
        <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 hover:shadow-lg transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-slate-500 dark:text-slate-400 text-sm font-semibold uppercase tracking-wide">Total Projects</p>
                    <p class="text-3xl font-bold text-slate-900 dark:text-white mt-2">{{ stats.total_projects }}</p>
                </div>
                <div class="p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                    <span class="material-symbols-outlined text-blue-600 dark:text-blue-400 text-[28px]">assignment</span>
                </div>
            </div>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-3">All compliance projects</p>
        </div>

        <!-- Active Projects -->
        <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 hover:shadow-lg transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-slate-500 dark:text-slate-400 text-sm font-semibold uppercase tracking-wide">In Progress</p>
                    <p class="text-3xl font-bold text-slate-900 dark:text-white mt-2">{{ stats.active_projects }}</p>
                </div>
                <div class="p-3 bg-amber-100 dark:bg-amber-900/30 rounded-lg">
                    <span class="material-symbols-outlined text-amber-600 dark:text-amber-400 text-[28px]">schedule</span>
                </div>
            </div>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-3">Currently active audits</p>
        </div>

        <!-- Completed -->
        <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 hover:shadow-lg transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-slate-500 dark:text-slate-400 text-sm font-semibold uppercase tracking-wide">Completed</p>
                    <p class="text-3xl font-bold text-slate-900 dark:text-white mt-2">{{ stats.completed_assessments }}</p>
                </div>
                <div class="p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg">
                    <span class="material-symbols-outlined text-emerald-600 dark:text-emerald-400 text-[28px]">check_circle</span>
                </div>
            </div>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-3">Finished assessments</p>
        </div>

        <!-- Pending Responses -->
        <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 hover:shadow-lg transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-slate-500 dark:text-slate-400 text-sm font-semibold uppercase tracking-wide">Pending</p>
                    <p class="text-3xl font-bold text-slate-900 dark:text-white mt-2">{{ stats.pending_responses }}</p>
                </div>
                <div class="p-3 bg-red-100 dark:bg-red-900/30 rounded-lg">
                    <span class="material-symbols-outlined text-red-600 dark:text-red-400 text-[28px]">pending_actions</span>
                </div>
            </div>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-3">Awaiting responses</p>
        </div>
    </div>

    <!-- Section Heading -->
    <div class="mb-6">
        <h2 class="text-xl font-bold text-slate-900 dark:text-white">Active Audit Projects</h2>
    </div>


    <!-- Project Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

        {% for item in active_projects %}
        {% set project = item.project %}
        <a href="/projects/{{ project.id }}"
            class="group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-lg transition-all hover:border-primary/40 overflow-hidden flex flex-col">
            <!-- Card Header with accent line -->
            <div class="h-1 bg-gradient-to-r from-primary via-primary to-blue-400"></div>

            <!-- Card Content -->
            <div class="p-6 flex flex-col flex-1">
                <!-- Framework + Status -->
                <div class="flex items-center justify-between gap-3 mb-4">
                    <span class="inline-flex items-center gap-1 bg-primary/10 text-primary px-3 py-1 rounded-full text-xs font-semibold">
                        <span class="material-symbols-outlined" style="font-size:14px">account_tree</span>
                        {{ project.framework.name if project.framework else "Framework" }}
                    </span>

                    {% set status_config = {
                    'not_started': {'bg': 'bg-slate-100 dark:bg-slate-800', 'text': 'text-slate-600 dark:text-slate-400', 'icon': 'radio_button_unchecked'},
                    'draft': {'bg': 'bg-slate-100 dark:bg-slate-800', 'text': 'text-slate-600 dark:text-slate-400', 'icon': 'edit'},
                    'in_progress': {'bg': 'bg-blue-100 dark:bg-blue-900/30', 'text': 'text-blue-700 dark:text-blue-400', 'icon': 'schedule'},
                    'review': {'bg': 'bg-amber-100 dark:bg-amber-900/30', 'text': 'text-amber-700 dark:text-amber-400', 'icon': 'preview'},
                    'completed': {'bg': 'bg-emerald-100 dark:bg-emerald-900/30', 'text': 'text-emerald-700 dark:text-emerald-400', 'icon': 'check_circle'}
                    } %}
                    {% set status_info = status_config.get(project.status.value, status_config['draft']) %}

                    <div class="flex items-center gap-1 {{ status_info.bg }} {{ status_info.text }} px-3 py-1 rounded-full text-xs font-semibold">
                        <span class="material-symbols-outlined" style="font-size:14px">{{ status_info.icon }}</span>
                        {{ project.status.value|replace('_', ' ')|title }}
                    </div>
                </div>

                <!-- Title and Description -->
                <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-2 group-hover:text-primary transition-colors line-clamp-1">
                    {{ project.name }}
                </h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 line-clamp-2 flex-1">
                    {{ project.description or "No description provided." }}
                </p>

                <!-- Client Info -->
                {% if project.client %}
                <div class="flex items-center gap-2 mb-4 pb-4 border-b border-slate-100 dark:border-slate-800">
                    <span class="material-symbols-outlined text-slate-400" style="font-size:16px">corporate_fare</span>
                    <span class="text-sm text-slate-600 dark:text-slate-400">{{ project.client.name }}</span>
                </div>
                {% endif %}

                <!-- Progress -->
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">
                            Progress
                            {% if item.total_controls > 0 %}
                            <span class="normal-case font-normal">({{ item.responded_count }}/{{ item.total_controls }})</span>
                            {% endif %}
                        </span>
                        <span class="text-sm font-bold text-slate-900 dark:text-white">{{ item.progress_pct }}%</span>
                    </div>
                    <div class="w-full bg-slate-100 dark:bg-slate-800 h-2 rounded-full overflow-hidden">
                        <div class="bg-gradient-to-r from-primary to-blue-400 h-full rounded-full transition-all" style="width: {{ item.progress_pct }}%"></div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="flex items-center justify-between mt-4 pt-4 border-t border-slate-100 dark:border-slate-800 text-xs">
                    <span class="text-slate-400">Updated recently</span>
                    <span class="inline-flex items-center gap-1 text-primary font-semibold group-hover:gap-2 transition-all">
                        View details
                        <span class="material-symbols-outlined" style="font-size:16px">arrow_forward</span>
                    </span>
                </div>
            </div>
        </a>
        {% endfor %}

        <!-- Add New Project Button -->
        <a href="/projects/new"
            class="group border-2 border-dashed border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 rounded-xl flex flex-col items-center justify-center p-8 hover:bg-slate-100 dark:hover:bg-slate-800 hover:border-primary/60 transition-all min-h-[300px]">
            <div class="bg-slate-200 dark:bg-slate-700 p-4 rounded-full mb-4 group-hover:bg-primary/20 transition-colors">
                <span class="material-symbols-outlined text-slate-600 dark:text-slate-400 group-hover:text-primary transition-colors text-[32px]">add_circle</span>
            </div>
            <span class="text-base font-bold text-slate-900 dark:text-slate-100 group-hover:text-primary transition-colors">New Project</span>
            <span class="text-xs text-slate-500 dark:text-slate-400 mt-2">Start a compliance audit</span>
        </a>
    </div>
</div>
{% endblock %}