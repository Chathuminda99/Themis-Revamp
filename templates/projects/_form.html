<form hx-post="{% if project %}/projects/{{ project.id }}{% else %}/projects{% endif %}" {% if project %}hx-target="#project-row-{{ project.id }}" hx-swap="outerHTML" {% else %}hx-target="#projects-table" hx-swap="beforeend" {% endif %}
  @submit="if (htmx.config.refreshOnHistoryMiss) htmx.ajax('GET', '/projects', {target: '#projects-table', swap: 'innerHTML'}); $store.modal.hide()">

  <div class="space-y-6">
    <!-- Header -->
    <div>
      <h2 class="text-xl font-semibold text-foreground">{% if project %}Update Project{% else %}New Project{% endif %}</h2>
      <p class="text-sm text-muted-foreground mt-1">Fill in the details below to {% if project %}update the{% else %}create a{% endif %} project.</p>
    </div>

    <!-- Project Name -->
    <div class="space-y-2">
      <label for="name" class="text-sm font-medium text-foreground">Project Name <span class="text-destructive">*</span></label>
      <input type="text" id="name" name="name" value="{{ project.name if project else '' }}" required placeholder="Enter project name"
        class="w-full flex h-10 rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 transition-colors" />
    </div>

    <!-- Client Search -->
    <div class="space-y-2">
      <label for="client_id" class="text-sm font-medium text-foreground">Client <span class="text-destructive">*</span></label>
      <input type="hidden" id="client_id" name="client_id" value="{{ project.client_id if project else '' }}" required />
      <div class="relative">
        <input type="text" id="client_search" name="q" placeholder="Start typing client name..."
          value="{% if project and project.client %}{{ project.client.name }}{% endif %}" autocomplete="off"
          class="w-full flex h-10 rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 transition-colors"
          hx-get="/clients/search" hx-trigger="keyup changed delay:300ms" hx-target="#client-suggestions" hx-swap="innerHTML" />
        <div id="client-suggestions" class="mt-2 text-sm text-muted-foreground absolute z-50 w-full"></div>
      </div>
    </div>

    <!-- Framework Select -->
    <div class="space-y-2">
      <label for="framework_id" class="text-sm font-medium text-foreground">Framework <span class="text-destructive">*</span></label>
      <div class="relative">
        <select id="framework_id" name="framework_id" required
          class="w-full flex h-10 appearance-none rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 transition-colors">
          <option value="">Select a framework...</option>
          {% for framework in frameworks %}
          <option value="{{ framework.id }}" {% if project and project.framework_id==framework.id %}selected{% endif %}>{{ framework.name }}</option>
          {% endfor %}
        </select>
        <span class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground">
          <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </span>
      </div>
    </div>

    <!-- Status Select -->
    <div class="space-y-2">
      <label for="status" class="text-sm font-medium text-foreground">Status</label>
      <div class="relative">
        <select id="status" name="status"
          class="w-full flex h-10 appearance-none rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 transition-colors">
          <option value="draft" {% if project and project.status.value=='draft' %}selected{% endif %}>Draft</option>
          <option value="in_progress" {% if project and project.status.value=='in_progress' %}selected{% endif %}>In Progress</option>
          <option value="completed" {% if project and project.status.value=='completed' %}selected{% endif %}>Completed</option>
          <option value="archived" {% if project and project.status.value=='archived' %}selected{% endif %}>Archived</option>
        </select>
        <span class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground">
          <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </span>
      </div>
    </div>

    <!-- Description -->
    <div class="space-y-2">
      <label for="description" class="text-sm font-medium text-foreground">Description</label>
      <textarea id="description" name="description" rows="4" placeholder="Enter project description (optional)"
        class="w-full flex rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 transition-colors resize-none">{{ project.description if project else '' }}</textarea>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-3 justify-end pt-4 border-t border-border">
      <button type="button" @click="$store.modal.hide()"
        class="inline-flex items-center justify-center gap-2 font-medium rounded-md px-4 py-2 text-sm transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed focus-visible:outline-none border border-input bg-background text-foreground hover:bg-muted">
        Cancel
      </button>
      <button type="submit"
        class="inline-flex items-center justify-center gap-2 font-medium rounded-md px-4 py-2 text-sm transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background bg-primary text-primary-foreground hover:opacity-90">
        <span class="material-symbols-outlined text-[18px]">{% if project %}edit{% else %}add_circle{% endif %}</span>
        {% if project %}Update{% else %}Create{% endif %} Project
      </button>
    </div>
  </div>
</form>