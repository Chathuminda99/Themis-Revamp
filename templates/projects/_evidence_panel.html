<div class="p-6 space-y-6">
    <!-- Header -->
    <div class="flex items-start justify-between gap-4">
        <div>
            <h2 class="text-base font-bold text-slate-900 dark:text-white">Evidence</h2>
            <p class="text-sm text-slate-500 dark:text-slate-400 mt-0.5 line-clamp-2">{{ observation.observation_text }}</p>
        </div>
    </div>

    <!-- Text Notes -->
    <div>
        <h3 class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-3">Text Notes</h3>
        {% set notes = observation.evidence_files | selectattr("evidence_type", "equalto", "text_note") | list %}
        {% if notes %}
        <div class="space-y-2 mb-4">
            {% for note in notes %}
            <div class="flex items-start gap-3 bg-slate-50 dark:bg-slate-800 rounded-lg p-3">
                <span class="material-symbols-outlined text-slate-400 text-[18px] flex-shrink-0 mt-0.5">sticky_note_2</span>
                <p class="text-sm text-slate-700 dark:text-slate-300 flex-1 break-words">{{ note.content }}</p>
                <button type="button"
                    hx-delete="/projects/{{ project_id }}/observations/{{ observation.id }}/evidence/{{ note.id }}"
                    hx-target="#modal-body"
                    hx-swap="innerHTML"
                    hx-confirm="Delete this note?"
                    class="text-slate-400 hover:text-red-500 transition-colors flex-shrink-0">
                    <span class="material-symbols-outlined text-[16px]">delete</span>
                </button>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-sm text-slate-400 italic mb-4">No text notes yet.</p>
        {% endif %}

        <!-- Add text note form -->
        <form hx-post="/projects/{{ project_id }}/observations/{{ observation.id }}/evidence/text"
              hx-target="#modal-body"
              hx-swap="innerHTML"
              class="flex gap-2">
            <textarea name="content" rows="2" placeholder="Add a text note..."
                class="flex-1 rounded-lg border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background resize-none transition-colors"></textarea>
            <button type="submit"
                class="px-3 py-2 bg-primary text-white rounded-lg text-sm font-bold hover:bg-primary/90 transition-all self-end flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">add</span>
                Add
            </button>
        </form>
    </div>

    <div class="border-t border-border"></div>

    <!-- Images / Files -->
    <div>
        <h3 class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-3">Images &amp; Files</h3>
        {% set images = observation.evidence_files | selectattr("evidence_type", "equalto", "image") | list %}
        {% if images %}
        <div class="grid grid-cols-2 gap-3 mb-4">
            {% for img in images %}
            <div class="relative group rounded-lg border border-border overflow-hidden bg-slate-50 dark:bg-slate-800">
                {% set ext = img.filename.rsplit('.', 1)[-1].lower() if img.filename else '' %}
                {% if ext in ['png', 'jpg', 'jpeg', 'gif', 'webp'] %}
                <a href="{{ img.file_path }}" target="_blank">
                    <img src="{{ img.file_path }}" alt="{{ img.filename }}" class="w-full h-28 object-cover">
                </a>
                {% else %}
                <a href="{{ img.file_path }}" target="_blank"
                   class="flex flex-col items-center justify-center h-28 gap-2 text-slate-500 hover:text-primary transition-colors">
                    <span class="material-symbols-outlined text-[32px]">description</span>
                    <span class="text-xs font-medium truncate px-2 w-full text-center">{{ img.filename }}</span>
                </a>
                {% endif %}
                <button type="button"
                    hx-delete="/projects/{{ project_id }}/observations/{{ observation.id }}/evidence/{{ img.id }}"
                    hx-target="#modal-body"
                    hx-swap="innerHTML"
                    hx-confirm="Delete this file?"
                    class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity">
                    <span class="material-symbols-outlined text-[14px]">close</span>
                </button>
                <p class="text-[10px] text-slate-400 px-2 py-1 truncate">{{ img.filename }}</p>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-sm text-slate-400 italic mb-4">No images or files yet.</p>
        {% endif %}

        <!-- Upload form -->
        <form hx-post="/projects/{{ project_id }}/observations/{{ observation.id }}/evidence/image"
              hx-target="#modal-body"
              hx-swap="innerHTML"
              hx-encoding="multipart/form-data"
              class="flex items-center gap-2">
            <label class="flex-1 flex items-center gap-2 px-3 py-2 rounded-lg border border-dashed border-input bg-background cursor-pointer hover:border-primary hover:bg-primary/5 transition-colors text-sm text-muted-foreground">
                <span class="material-symbols-outlined text-[16px]">upload_file</span>
                <span class="truncate" id="evidence-file-label-{{ observation.id }}">Choose image or PDF…</span>
                <input type="file" name="file" accept="image/*,.pdf"
                    class="hidden"
                    onchange="document.getElementById('evidence-file-label-{{ observation.id }}').textContent = this.files[0]?.name || 'Choose image or PDF…'">
            </label>
            <button type="submit"
                class="px-3 py-2 bg-primary text-white rounded-lg text-sm font-bold hover:bg-primary/90 transition-all flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">upload</span>
                Upload
            </button>
        </form>
    </div>
</div>
