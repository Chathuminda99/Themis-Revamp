{%- import "components/_icon.html" as icon_macro -%}

<!-- Top Header (CoreUI-inspired) -->
<header
    class="h-16 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between px-6 z-20 sticky top-0">
    <!-- Left: Menu toggle + Search -->
    <div class="flex items-center gap-4 flex-1">
        <button @click="sidebarOpen = !sidebarOpen"
            class="p-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary/50"
            title="Toggle sidebar">
            {{ icon_macro.icon('menu', 'currentColor', '22') }}
        </button>
        <div class="relative w-full max-w-sm hidden sm:block">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">{{ icon_macro.icon('search', 'currentColor', '18') }}</span>
            <input
                class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-lg pl-10 pr-4 py-2 text-sm focus:ring-2 focus:ring-primary/50 transition-all text-slate-900 dark:text-slate-100 placeholder-slate-500"
                placeholder="Search..." type="text">
        </div>
    </div>

    <!-- Right: Actions + User Menu -->
    <div class="flex items-center gap-2">
        <!-- Create Project Button -->
        <a href="/projects/new"
            class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all shadow-sm shadow-primary/20 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-primary/50 whitespace-nowrap">
            {{ icon_macro.icon('plus', 'white', '18') }}
            <span class="hidden sm:inline">New Project</span>
        </a>

        <!-- Divider -->
        <div class="h-6 w-[1px] bg-slate-200 dark:bg-slate-700 mx-1"></div>

        <!-- Notifications -->
        <button
            class="p-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg relative transition-colors focus:outline-none focus:ring-2 focus:ring-primary/50"
            title="Notifications">
            {{ icon_macro.icon('bell', 'currentColor', '22') }}
            <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full border border-white dark:border-slate-900"></span>
        </button>

        <!-- Help -->
        <button
            class="p-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary/50 hidden sm:flex items-center justify-center"
            title="Help">
            {{ icon_macro.icon('help-circle', 'currentColor', '22') }}
        </button>

        <!-- Divider -->
        <div class="h-6 w-[1px] bg-slate-200 dark:bg-slate-700 mx-1"></div>

        <!-- Theme Switcher (Light/Dark/Auto) -->
        <div class="relative group">
            <button
                class="p-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary/50"
                title="Theme">
                {{ icon_macro.icon('sun', 'currentColor', '22') }}
            </button>
            <div class="absolute right-0 mt-0 hidden group-hover:block bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-lg p-2 min-w-[150px] z-50">
                <button class="w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors text-left text-slate-700 dark:text-slate-300">
                    {{ icon_macro.icon('sun', 'currentColor', '18') }}
                    Light
                </button>
                <button class="w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors text-left text-slate-700 dark:text-slate-300">
                    {{ icon_macro.icon('moon', 'currentColor', '18') }}
                    Dark
                </button>
                <button class="w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors text-left text-slate-700 dark:text-slate-300">
                    {{ icon_macro.icon('sun', 'currentColor', '18') }}
                    Auto
                </button>
            </div>
        </div>

        <!-- User Profile Dropdown -->
        <div class="relative group">
            <button
                class="flex items-center gap-2 p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors focus:outline-none focus:ring-2 focus:ring-primary/50"
                title="User menu">
                <div class="w-8 h-8 rounded-full bg-primary/10 border border-primary/30 flex items-center justify-center text-primary font-bold text-sm">
                    {% if user %}{{ user.full_name[0].upper() }}{% else %}U{% endif %}
                </div>
                <span class="hidden sm:inline text-sm font-semibold text-slate-700 dark:text-slate-300">
                    {% if user %}{{ user.full_name.split()[0] }}{% else %}User{% endif %}
                </span>
                <span class="hidden sm:inline text-slate-600 dark:text-slate-400">{{ icon_macro.icon('chevron-down', 'currentColor', '18') }}</span>
            </button>

            <!-- Dropdown Menu -->
            <div class="absolute right-0 mt-0 hidden group-hover:block bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-lg py-2 min-w-[200px] z-50">
                <div class="px-4 py-2 border-b border-slate-200 dark:border-slate-700">
                    <p class="text-sm font-semibold text-slate-900 dark:text-slate-100">
                        {% if user %}{{ user.full_name }}{% else %}User{% endif %}
                    </p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">
                        {% if user %}{{ user.email }}{% else %}user@example.com{% endif %}
                    </p>
                </div>
                <a href="#"
                    class="flex items-center gap-2 px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                    {{ icon_macro.icon('user', 'currentColor', '18') }}
                    Profile
                </a>
                <a href="#"
                    class="flex items-center gap-2 px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                    {{ icon_macro.icon('settings', 'currentColor', '18') }}
                    Settings
                </a>
                <div class="border-t border-slate-200 dark:border-slate-700 my-2"></div>
                <form method="POST" action="/auth/logout" class="block">
                    <button type="submit"
                        class="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors text-left">
                        {{ icon_macro.icon('logout', 'currentColor', '18') }}
                        Sign Out
                    </button>
                </form>
            </div>
        </div>
    </div>
</header>