{# Custom Modern Dropdown Component #}
{# Replaces native select with beautiful custom dropdown #}
{# Usage:
   {% include "components/custom_select.html" with context %}
   {#
     select_id="status",
     select_name="status",
     select_value="draft",
     select_options=[{"value": "draft", "label": "Draft"}, ...],
     select_label="Status",
     on_change="htmx_trigger"
   #}
#}

<div class="space-y-2">
  {% if select_label %}
  <label for="{{ select_id }}" class="text-sm font-medium text-foreground">{{ select_label }}</label>
  {% endif %}

  <div x-data="{ open: false, value: '{{ select_value }}' }" @click.outside="open = false" class="relative">
    <!-- Closed State Button -->
    <button
      @click="open = !open"
      type="button"
      class="w-full flex items-center justify-between h-10 px-4 py-2 rounded-md border-2 border-primary text-foreground bg-background hover:bg-muted transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
    >
      <span x-text="($el.parentElement.querySelector('[x-current-label]') || {textContent: 'Select...'}).textContent"></span>
      <svg class="w-4 h-4" :class="{ 'rotate-180': open }" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>

    <!-- Hidden Select for Form Submission -->
    <input type="hidden" id="{{ select_id }}" name="{{ select_name }}" :value="value" />

    <!-- Dropdown Menu -->
    <div
      x-show="open"
      x-transition:enter="transition ease-out duration-100"
      x-transition:enter-start="opacity-0 -translate-y-2"
      x-transition:enter-end="opacity-100 translate-y-0"
      class="absolute top-full left-0 right-0 mt-2 bg-card text-card-foreground border border-border rounded-md shadow-lg z-50 overflow-hidden"
    >
      <ul class="max-h-48 overflow-y-auto">
        {% for option in select_options %}
        <li>
          <button
            type="button"
            @click="
              value = '{{ option.value }}';
              open = false;
              $el.closest('[x-data]').querySelector('input[type=hidden]').value = '{{ option.value }}';
              {% if on_change %}{{ on_change }}{% endif %}
            "
            x-current-label
            class="w-full text-left px-4 py-3 hover:bg-muted transition-colors"
            :class="{
              'bg-primary text-primary-foreground hover:bg-primary/90': value === '{{ option.value }}',
              'bg-card text-card-foreground': value !== '{{ option.value }}'
            }"
          >
            {{ option.label }}
          </button>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>
